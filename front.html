<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload Photos & Videos</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background-image: 
                linear-gradient(135deg, rgba(0, 26, 77, 0.5) 0%, rgba(13, 59, 102, 0.6) 100%),
                url('https://raw.githubusercontent.com/haruhiiiiiiiiiiiiiii/Davreignne-s-Debut-Album/main/MOT04452.JPG');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            background-repeat: no-repeat;
            min-height: 100vh; 
            padding: 20px; 
            position: relative; 
            overflow-x: hidden; 
        }
        
        .sparkle-1 { position: fixed; width: 8px; height: 8px; background: radial-gradient(circle, #ffffff 0%, rgba(255,255,255,0.3) 70%); border-radius: 50%; top: 15%; left: 5%; animation: twinkle 2s ease-in-out infinite, float-random 6s ease-in-out infinite; box-shadow: 0 0 15px rgba(192, 192, 192, 0.8); z-index: 1; }
        .sparkle-2 { position: fixed; width: 6px; height: 6px; background: radial-gradient(circle, #e8e8e8 0%, rgba(192,192,192,0.3) 70%); border-radius: 50%; top: 30%; right: 8%; animation: twinkle 2.5s ease-in-out infinite 0.5s, float-random 7s ease-in-out infinite; box-shadow: 0 0 12px rgba(200, 200, 200, 0.7); z-index: 1; }
        
        @keyframes twinkle { 0%, 100% { opacity: 0.3; } 50% { opacity: 1; } }
        @keyframes float-random { 0% { transform: translateY(0px) translateX(0px); } 25% { transform: translateY(-15px) translateX(10px); } 50% { transform: translateY(-30px) translateX(-10px); } 75% { transform: translateY(-15px) translateX(15px); } 100% { transform: translateY(0px) translateX(0px); } }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-30px); } to { opacity: 1; transform: translateY(0); } }
        
        .container { max-width: 800px; margin: 0 auto; background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); border-radius: 25px; box-shadow: 0 20px 40px rgba(0,0,0,0.3), 0 0 30px rgba(192, 192, 192, 0.2); padding: 40px; border: 3px solid; border-image: linear-gradient(135deg, #c0c0c0 0%, #e8e8e8 50%, #c0c0c0 100%) 1; position: relative; z-index: 10; animation: slideDown 0.8s ease-out; }
        h1 { text-align: center; color: #001a4d; margin-bottom: 10px; font-size: 2.5em; background: linear-gradient(135deg, #001a4d 0%, #c0c0c0 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        .subtitle { text-align: center; color: #555; margin-bottom: 30px; font-size: 1.1em; }
        
        .album-selector { background: linear-gradient(135deg, #f5f5f5 0%, #fafafa 100%); padding: 25px; border-radius: 15px; border: 2px solid #c0c0c0; margin-bottom: 20px; }
        .album-selector-label { display: block; font-size: 1.1em; font-weight: bold; color: #001a4d; margin-bottom: 12px; }
        .album-selector-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; }
        .album-option { padding: 12px; border: 2px solid #c0c0c0; border-radius: 10px; background: white; cursor: pointer; transition: all 0.3s ease; text-align: center; font-size: 0.95em; }
        .album-option:hover { border-color: #001a4d; background: #fafafa; transform: scale(1.02); }
        .album-option.selected { background: linear-gradient(135deg, #001a4d 0%, #0d3b66 100%); color: #c0c0c0; border-color: #001a4d; font-weight: bold; box-shadow: 0 5px 15px rgba(0, 26, 77, 0.3); }
        
        .current-album-info { text-align: center; background: linear-gradient(135deg, #001a4d 0%, #0d3b66 100%); color: #c0c0c0; padding: 15px; border-radius: 12px; margin-bottom: 20px; font-size: 1.2em; font-weight: bold; box-shadow: 0 0 15px rgba(192, 192, 192, 0.2); }
        
        .upload-area { border: 4px dashed #001a4d; border-radius: 20px; padding: 60px 30px; text-align: center; margin-bottom: 20px; transition: all 0.3s ease; background: rgba(250, 250, 250, 0.8); cursor: pointer; }
        .upload-area:hover { border-color: #c0c0c0; background: rgba(245, 245, 245, 0.9); transform: scale(1.02); }
        .upload-area.dragover { border-color: #c0c0c0; background: rgba(240, 240, 240, 0.9); border-width: 5px; }
        .upload-area div { font-size: 1.3em; margin-bottom: 20px; }
        #fileInput { display: none; }
        .upload-btn { background: linear-gradient(135deg, #001a4d 0%, #0d3b66 100%); color: #c0c0c0; padding: 15px 40px; border: none; border-radius: 50px; font-size: 1.2em; cursor: pointer; transition: all 0.3s ease; margin-top: 15px; font-weight: bold; box-shadow: 0 5px 15px rgba(0, 26, 77, 0.4); }
        .upload-btn:hover { transform: translateY(-3px); box-shadow: 0 8px 20px rgba(0, 26, 77, 0.6); }
        .upload-btn:disabled { opacity: 0.5; cursor: not-allowed; }
        
        .name-input { width: 100%; padding: 15px; margin: 20px 0; border: 2px solid #c0c0c0; border-radius: 12px; font-size: 1.1em; transition: all 0.3s ease; background: white; }
        .name-input:focus { outline: none; border-color: #001a4d; box-shadow: 0 0 10px rgba(0, 26, 77, 0.3); }
        
        .view-gallery { text-align: center; margin: 25px 0; display: flex; gap: 12px; justify-content: center; flex-wrap: wrap; }
        .view-gallery a { background: linear-gradient(135deg, #e8e8e8 0%, #f5f5f5 50%, #e8e8e8 100%); color: #001a4d; padding: 14px 30px; border-radius: 50px; text-decoration: none; font-weight: bold; transition: all 0.3s ease; box-shadow: 0 5px 15px rgba(192, 192, 192, 0.4); border: 2px solid rgba(192, 192, 192, 0.5); }
        .view-gallery a:hover { transform: translateY(-3px); box-shadow: 0 8px 25px rgba(192, 192, 192, 0.6); }
        
        .success { background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%); color: #155724; padding: 18px; border-radius: 12px; margin: 20px 0; display: none; border: 2px solid #28a745; }
        .error { background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%); color: #721c24; padding: 18px; border-radius: 12px; margin: 20px 0; display: none; border: 2px solid #f5365c; }
        
        .stats { text-align: center; margin-top: 25px; padding: 20px; background: rgba(250, 250, 250, 0.8); border-radius: 12px; border: 2px solid #c0c0c0; }
        .stat-number { font-size: 2em; font-weight: bold; color: #001a4d; }
        .stat-label { color: #666; font-size: 0.95em; }
        
        .loading { text-align: center; padding: 20px; display: none; }
        .loading-spinner { display: inline-block; width: 40px; height: 40px; border: 4px solid #f3f3f3; border-top: 4px solid #001a4d; border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 10px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        @media (max-width: 768px) { body { background-attachment: scroll; } }
        @media (max-width: 600px) { .container { padding: 20px; } h1 { font-size: 2em; } .upload-area { padding: 40px 20px; } }
    </style>
</head>
<body>
    <div class="sparkle-1"></div>
    <div class="sparkle-2"></div>
    
    <div class="container">
        <h1>Upload Photos & Videos</h1>
        <p class="subtitle">Share your memories with everyone ðŸŒŸ</p>
        
        <div class="album-selector">
            <label class="album-selector-label">Select Album:</label>
            <div class="album-selector-grid" id="albumGrid"></div>
        </div>
        
        <div class="current-album-info" id="currentAlbumInfo">
            <span id="currentAlbumName">Table 1</span>
        </div>
        
        <div class="view-gallery">
            <a href="#" id="viewGalleryLink">View This Album</a>
            <a href="albums.html">All Albums</a>
        </div>
        
        <div class="success" id="successMsg"></div>
        <div class="error" id="errorMsg"></div>
        
        <div class="upload-area" id="uploadArea" onclick="document.getElementById('fileInput').click()">
            <div>ðŸ“¸</div>
            <div>Drag & drop photos/videos here or click to browse</div>
            <input type="file" id="fileInput" multiple accept="image/*,video/*">
            <button class="upload-btn" onclick="event.stopPropagation(); document.getElementById('fileInput').click()">
                Choose Files
            </button>
        </div>
        
        <div class="loading" id="loading">
            <div class="loading-spinner"></div>
            <div style="font-size: 1.2em; color: #001a4d; font-weight: bold;">Uploading to cloud...</div>
        </div>
        
        <input type="text" class="name-input" id="uploaderName" placeholder="Your name" required>
        
        <div class="stats">
            <div class="stat-number" id="photoCount">Loading...</div>
            <div class="stat-label">Photos/Videos in this album (visible to everyone)</div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, addDoc, getDocs, query, orderBy } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyDPaMpRBwk8a10vX4CUvsolfUyn3gpec5s",
            authDomain: "debut-photo-gallery.firebaseapp.com",
            projectId: "debut-photo-gallery",
            storageBucket: "debut-photo-gallery.firebasestorage.app",
            messagingSenderId: "954052989718",
            appId: "1:954052989718:web:8faaeeaa9aebe726f67637"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        
        const albumsList = [
            { id: 1, name: 'Table 1' }, { id: 2, name: 'Table 2' }, { id: 3, name: 'Table 3' },
            { id: 4, name: 'Table 4' }, { id: 5, name: 'Table 5' }, { id: 6, name: 'Table 6' },
            { id: 7, name: 'Table 7' }, { id: 8, name: 'Table 8' }, { id: 9, name: 'Table 9' },
            { id: 10, name: 'Table 10' }, { id: 11, name: 'Table 11' }, { id: 12, name: 'Table 12' },
            { id: 13, name: 'Table 13' }, { id: 14, name: 'Table 14' }, { id: 15, name: '18 Roses' },
            { id: 16, name: '18 Candles' }, { id: 17, name: '18 Blue Bills' }, 
            { id: 18, name: '18 Treasures' }, { id: 19, name: '18 Shots' }
        ];
        
        let currentAlbumId = 1;
        
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const loading = document.getElementById('loading');
        const successMsg = document.getElementById('successMsg');
        const errorMsg = document.getElementById('errorMsg');
        const uploaderName = document.getElementById('uploaderName');
        const photoCount = document.getElementById('photoCount');
        const currentAlbumName = document.getElementById('currentAlbumName');
        const viewGalleryLink = document.getElementById('viewGalleryLink');
        const albumGrid = document.getElementById('albumGrid');

        function renderAlbumSelector() {
            albumGrid.innerHTML = '';
            albumsList.forEach(album => {
                const option = document.createElement('div');
                option.className = 'album-option' + (album.id === currentAlbumId ? ' selected' : '');
                option.id = `album-${album.id}`;
                option.onclick = () => selectAlbum(album.id, album.name);
                option.innerHTML = `<span>${album.name}</span>`;
                albumGrid.appendChild(option);
            });
        }

        function selectAlbum(id, name) {
            currentAlbumId = id;
            document.querySelectorAll('.album-option').forEach(el => el.classList.remove('selected'));
            const selected = document.getElementById(`album-${id}`);
            if (selected) selected.classList.add('selected');
            currentAlbumName.textContent = name;
            viewGalleryLink.href = `album.html?album=${id}`;
            updatePhotoCount();
        }

        async function updatePhotoCount() {
            try {
                const q = query(collection(db, `albums/${currentAlbumId}/photos`));
                const snapshot = await getDocs(q);
                photoCount.textContent = snapshot.size;
            } catch (e) {
                console.error('Error counting photos:', e);
                photoCount.textContent = '0';
            }
        }

        function showError(msg) {
            errorMsg.textContent = msg;
            errorMsg.style.display = 'block';
            setTimeout(() => { errorMsg.style.display = 'none'; }, 5000);
        }

        function showSuccess(msg) {
            successMsg.textContent = msg;
            successMsg.style.display = 'block';
            setTimeout(() => { successMsg.style.display = 'none'; }, 5000);
        }

        ['dragover', 'dragenter'].forEach(event => {
            uploadArea.addEventListener(event, (e) => {
                e.preventDefault();
                e.stopPropagation();
                uploadArea.classList.add('dragover');
            });
        });

        ['dragleave', 'drop'].forEach(event => {
            uploadArea.addEventListener(event, (e) => {
                e.preventDefault();
                e.stopPropagation();
                uploadArea.classList.remove('dragover');
            });
        });

        uploadArea.addEventListener('drop', (e) => {
            fileInput.files = e.dataTransfer.files;
            handleFiles();
        });

        fileInput.addEventListener('change', handleFiles);

        async function handleFiles() {
            const files = Array.from(fileInput.files);
            if (files.length === 0) return;

            const nameValue = uploaderName.value.trim();
            if (!nameValue) {
                showError('Please enter your name before uploading.');
                fileInput.value = '';
                return;
            }

            loading.style.display = 'block';
            uploadArea.style.display = 'none';

            let uploadedCount = 0;
            let errors = 0;

            for (const file of files) {
                if (!file.type.startsWith('image/') && !file.type.startsWith('video/')) {
                    errors++;
                    continue;
                }

                try {
                    const dataUrl = await readFileAsDataURL(file);
                    
                    await addDoc(collection(db, `albums/${currentAlbumId}/photos`), {
                        name: file.name,
                        dataUrl: dataUrl,
                        timestamp: Date.now(),
                        uploader: nameValue,
                        size: file.size,
                        type: file.type
                    });

                    uploadedCount++;
                    console.log(`âœ“ Uploaded: ${file.name}`);
                } catch (error) {
                    console.error('Upload error:', error);
                    errors++;
                }
            }

            loading.style.display = 'none';
            uploadArea.style.display = 'block';
            fileInput.value = '';

            await updatePhotoCount();

            if (uploadedCount > 0) {
                showSuccess(`âœ“ ${uploadedCount} file(s) uploaded successfully! Everyone can now see them! ðŸŽ‰`);
            }
            if (errors > 0) {
                showError(`${errors} file(s) failed to upload.`);
            }
        }

        function readFileAsDataURL(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (e) => resolve(e.target.result);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }

        renderAlbumSelector();
        selectAlbum(1, 'Table 1');
        updatePhotoCount();
    </script>
</body>
</html>
