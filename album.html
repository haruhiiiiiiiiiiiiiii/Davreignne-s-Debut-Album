<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Photo Gallery - Debug</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-image: 
                linear-gradient(135deg, rgba(0, 26, 77, 0.35) 0%, rgba(13, 59, 102, 0.45) 100%),
                url('https://raw.githubusercontent.com/haruhiiiiiiiiiiiiiii/Davreignne-s-Debut-Album/main/MOT04452.JPG');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            background-repeat: no-repeat;
            min-height: 100vh;
            padding: 15px;
        }

        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            background: rgba(255, 255, 255, 0.88);
            backdrop-filter: blur(8px);
            border-radius: 25px; 
            box-shadow: 0 20px 60px rgba(0,0,0,0.3), 0 0 40px rgba(192, 192, 192, 0.2); 
            padding: 30px;
            border: 3px solid;
            border-image: linear-gradient(135deg, #c0c0c0 0%, #e8e8e8 50%, #c0c0c0 100%) 1;
        }
        
        h1 { 
            text-align: center; 
            color: #001a4d; 
            margin-bottom: 8px; 
            font-size: 2.5em;
            background: linear-gradient(135deg, #001a4d 0%, #c0c0c0 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .debug-info {
            background: #fff3cd;
            border: 2px solid #ffc107;
            padding: 15px;
            margin: 20px 0;
            border-radius: 10px;
            font-family: monospace;
            font-size: 0.9em;
        }
        
        .debug-info h3 {
            color: #856404;
            margin-bottom: 10px;
        }
        
        .photos-grid { 
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .photo-thumbnail {
            border-radius: 16px;
            overflow: hidden;
            cursor: pointer;
            aspect-ratio: 1;
            position: relative;
            transition: all 0.3s ease;
            background: linear-gradient(135deg, #e8e8e8 0%, #c0c0c0 100%);
            padding: 4px;
            box-shadow: 0 10px 30px rgba(192, 192, 192, 0.2);
        }
        
        .photo-thumbnail:hover {
            transform: scale(1.08) translateY(-8px);
            box-shadow: 0 20px 50px rgba(192, 192, 192, 0.4);
        }
        
        .photo-thumbnail-inner {
            width: 100%;
            height: 100%;
            border-radius: 12px;
            overflow: hidden;
            background: white;
        }
        
        .photo-thumbnail img,
        .photo-thumbnail video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }
        
        .view-gallery { 
            text-align: center; 
            margin: 25px 0; 
            display: flex;
            gap: 12px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .view-gallery a { 
            background: linear-gradient(135deg, #e8e8e8 0%, #f5f5f5 50%, #e8e8e8 100%);
            color: #001a4d; 
            padding: 14px 30px; 
            border-radius: 50px; 
            text-decoration: none; 
            font-weight: bold;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(192, 192, 192, 0.4);
            border: 2px solid rgba(192, 192, 192, 0.5);
        }
        
        .view-gallery a:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(192, 192, 192, 0.6);
        }
        
        #noPhotos {
            text-align: center;
            padding: 60px 20px;
            display: none;
        }
        
        #noPhotos h3 {
            color: #001a4d;
            margin-bottom: 15px;
            font-size: 1.5em;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Photo Gallery - Debug Mode</h1>
        
        <div class="debug-info">
            <h3>Debug Information:</h3>
            <div id="debugOutput">Loading...</div>
        </div>
        
        <div class="view-gallery">
            <a href="index.html" id="uploadLink">Upload More</a>
            <a href="albums.html">Change Album</a>
        </div>
        
        <div id="photosGrid" class="photos-grid"></div>
        
        <div id="noPhotos">
            <h3>No photos yet</h3>
            <p>Be the first to upload! <a href="index.html" style="color: #001a4d; font-weight: bold;">Upload now â†’</a></p>
        </div>
    </div>

    <script>
        const STORAGE_KEY = 'qr_photo_albums';
        
        const urlParams = new URLSearchParams(window.location.search);
        const currentAlbumId = parseInt(urlParams.get('album')) || 1;
        
        const photosGrid = document.getElementById('photosGrid');
        const noPhotos = document.getElementById('noPhotos');
        const debugOutput = document.getElementById('debugOutput');
        const uploadLink = document.getElementById('uploadLink');
        
        uploadLink.href = `index.html?album=${currentAlbumId}`;

        function addPhotoThumbnail(name, src, uploader, timestamp, photoId) {
            const thumbnail = document.createElement('div');
            thumbnail.className = 'photo-thumbnail';
            thumbnail.id = `thumb-${photoId}`;
            
            const isVideo = (src && (src.startsWith('video') || src.startsWith('data:video')));
            
            thumbnail.innerHTML = `
                <div class="photo-thumbnail-inner">
                    ${isVideo ? 
                        `<video src="${src}" muted preload="metadata"></video>` : 
                        `<img src="${src}" alt="${name}" loading="lazy">`
                    }
                </div>
            `;
            photosGrid.appendChild(thumbnail);
        }

        window.onload = () => {
            try {
                // Get all storage data
                const allAlbums = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {};
                
                // Debug output
                let debugText = `Current Album ID: ${currentAlbumId}<br>`;
                debugText += `Storage Key: ${STORAGE_KEY}<br>`;
                debugText += `Total Albums in Storage: ${Object.keys(allAlbums).length}<br><br>`;
                
                // Show all albums
                debugText += `Albums found:<br>`;
                for (let albumId in allAlbums) {
                    debugText += `- Album ${albumId}: ${allAlbums[albumId].length} items<br>`;
                }
                debugText += `<br>`;
                
                // Get current album photos
                const currentPhotos = allAlbums[currentAlbumId] || [];
                debugText += `Photos in current album (${currentAlbumId}): ${currentPhotos.length}<br><br>`;
                
                if (currentPhotos.length > 0) {
                    debugText += `Sample photo data:<br>`;
                    const sample = currentPhotos[0];
                    debugText += `- Name: ${sample.name}<br>`;
                    debugText += `- Uploader: ${sample.uploader}<br>`;
                    debugText += `- Has dataUrl: ${!!sample.dataUrl}<br>`;
                    debugText += `- DataUrl starts with: ${sample.dataUrl ? sample.dataUrl.substring(0, 30) + '...' : 'N/A'}<br>`;
                    debugText += `- Type: ${sample.type}<br>`;
                    debugText += `- Size: ${sample.size} bytes<br>`;
                }
                
                debugOutput.innerHTML = debugText;
                
                // Display photos
                if (currentPhotos.length === 0) {
                    noPhotos.style.display = 'block';
                } else {
                    currentPhotos.forEach(photo => {
                        addPhotoThumbnail(
                            photo.name,
                            photo.dataUrl,
                            photo.uploader,
                            photo.timestamp,
                            photo.id
                        );
                    });
                }
                
            } catch (e) {
                debugOutput.innerHTML = `ERROR: ${e.message}<br><br>${e.stack}`;
                console.error('Error loading photos:', e);
            }
        };
    </script>
</body>
</html>
